var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,r=(e,t,n)=>(i(e,"symbol"!=typeof t?t+"":t,n),n);import{R as c,x as d,w as u,F as l,G as p}from"./vendor.bbf9911b.js";import{b2 as m,ca as h,cb as w,at as v,cc as f,L as b,cd as L,Z as g,aZ as y,M as k,H as E,av as U,a9 as I,ce as O}from"./index.190edc01.js";import{i as S,e as z,a as T,B,c as j,W as x}from"./index.f9be2f73.js";function C(e){return async(r,c)=>{const d=m(c()),u=h(c(),d.id),l=u.automaticTimezone!==e;if(u.useAutomaticTimezone&&l){const l={useAutomaticTimezone:"true",automaticTimezone:e,manualTimezone:u.manualTimezone},m=(p=((e,t)=>{for(var n in t||(t={}))s.call(t,n)&&i(e,n,t[n]);if(o)for(var n of o(t))a.call(t,n)&&i(e,n,t[n]);return e})({},d),t(p,n({timezone:l})));w(m)(r,c)}var p;return{}}}const A=v.dispatch,D=v.getState;class M extends c.PureComponent{constructor(e){super(e),r(this,"onDesktopMessageListener",(e=>{const{origin:t,data:{type:n,message:o={}}={}}=e;if(this.props.currentUser&&t===window.location.origin)switch(n){case"register-desktop":{const{version:e}=o;window.desktop||(window.desktop={}),window.desktop.version=u.valid(u.coerce(e));break}case"user-activity-update":{const{userIsActive:e,manual:t}=o;!0!==e&&!1!==e||x.userUpdateActiveStatus(e,t);break}case"notification-clicked":{const{channel:e,teamId:t}=o;window.focus(),this.props.actions.getChannelURLAction(e,t);break}}})),r(this,"handleBackSpace",(e=>{8!==e.which||["input","textarea"].includes(e.target.tagName.toLowerCase())||e.preventDefault()})),r(this,"handleBeforeUnload",(()=>{window.removeEventListener("beforeunload",this.handleBeforeUnload),document.cookie.indexOf(`${g.COOKIE.SESSION_USER}=`)>-1&&y("",this.props.currentChannelId||"")(A,D),j()}));const t=document.getElementById("mexty-quik");t&&(t.className+=" channel-view")}isValidState(){return null!=this.props.currentUser}componentDidMount(){const{currentUser:e,enableTimezone:t,actions:n,location:o,history:s,clientId:a}=this.props;if(S(),t&&n.autoUpdateTimezone(f()),window.addEventListener("beforeunload",this.handleBeforeUnload),window.addEventListener("focus",this.onFocusListener),window.addEventListener("blur",this.onBlurListener),document.hasFocus()||z(!1),window.addEventListener("message",this.onDesktopMessageListener),window.postMessage({type:"webapp-ready"},window.location.origin),!e)return b.removeUserId(a),b.removeToken(a),void T("/error?type=no-auth&redirect_to="+encodeURIComponent(o.pathname),!0,!1,s);window.addEventListener("keydown",this.handleBackSpace),this.isValidState()&&B.signalLogin()}componentWillUnmount(){j(),window.removeEventListener("keydown",this.handleBackSpace),window.removeEventListener("focus",this.onFocusListener),window.removeEventListener("blur",this.onBlurListener),window.removeEventListener("message",this.onDesktopMessageListener)}render(){return this.isValidState()?this.props.children:d(L,{message:"Xác thực tài khoản"})}onFocusListener(){z(!0)}onBlurListener(){z(!1)}}var P=M;const F=(e,t)=>(n,o)=>I.push(O(o(),e,t));var R=l((function(e){const t=k(e),n=E();return{currentUser:m(e),currentChannelId:U(e),enableTimezone:"true"===t.ExperimentalTimezone,clientId:n.clientId}}),(function(e){return{actions:p({autoUpdateTimezone:C,getChannelURLAction:F},e)}}))(P);export{R as default};
